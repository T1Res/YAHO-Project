<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>프로필</title>
</head>
<body>

  <!-- 프로필 표시용 테이블 -->
  <table align="center" border="0" width="600" cellpadding="5" cellspacing="0">
    <tr><th colspan="2"><h2>프로필</h2></th></tr>

    <!-- 프로필 사진 -->
    <tr>
      <td><img th:src="${dto.USER_PROFILE_IMG}"></td>
    </tr>

    <!-- 이름 -->
    <tr>
      <td>이름</td>
      <td th:text="${dto.USER_NICKNAME}"></td>
    </tr>

    <!-- ID -->
    <tr>
      <td>ID</td>
      <td th:text="${dto.USER_ID}"></td>
    </tr>

    <!-- 성별 -->
    <tr>
      <td>성별</td>
      <td th:text="${dto.USER_GENDER == 1 ? '남자' : (dto.USER_GENDER == 2 ? '여자' : '미지정')}"></td>
    </tr>

    <!-- 이메일 -->
    <tr>
      <td>이메일</td>
      <td th:text="${dto.USER_EMAIL}"></td>
    </tr>

    <!-- 한줄소개 -->
    <tr>
      <td>한줄소개</td>
      <td th:text="${dto.USER_BIO}"></td>
    </tr>

    <!-- 버튼 -->
    <tr>
      <td colspan="2" align="center">
        <button type="button" onclick="openPasswordModal()">회원탈퇴</button>
        <button type="button" onclick="history.back()">돌아가기</button>
      </td>
    </tr>
  </table>

  <!-- 탈퇴 확인 모달 -->
  <div id="passwordModal" style="display: none; position: fixed; background: rgba(0,0,0,0.5); top: 0; left: 0; right: 0; bottom: 0;">
    <div style="background: white; width: 300px; margin: 100px auto; padding: 20px; text-align: center;">
      <h3>비밀번호 확인</h3>
      <form id="deleteForm">
  		<input type="password" id="deletePassword" name="password" placeholder="비밀번호 입력" required style="width: 80%; padding: 5px;"><br>
  		<div id="deleteError" style="color: red; font-size: 0.9em; margin-top: 5px;"></div>
  		<br>
  		<button type="button" onclick="submitDelete()">탈퇴</button>
  		<button type="button" onclick="closePasswordModal()">취소</button>
	</form>
    </div>
  </div>

  <script>
  function openPasswordModal() {
    document.getElementById("passwordModal").style.display = "block";
    document.getElementById("deletePassword").value = "";
    document.getElementById("deleteError").innerText = "";
  }

  function closePasswordModal() {
    document.getElementById("passwordModal").style.display = "none";
  }

  function submitDelete() {
    const password = document.getElementById("deletePassword").value;
    const errorBox = document.getElementById("deleteError");

    fetch("/User/User_Delete", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: "password=" + encodeURIComponent(password)
    })
    .then(res => {
		if (!res.ok) {
			errorBox.innerText = "비밀번호가 틀렸습니다.";
			throw res;
		}
		return res.text();
	})
    .then(() => {
		console.log("회원 삭제 성공");
		//closePasswordModal();

		// ✅ 탈퇴 성공 모달 띄우기
		document.getElementById("successModal").style.display = "block";
		document.getElementById("successOverlay").style.display = "block";

		// ✅ 2초 후 메인 페이지로 이동
		setTimeout(() => {
			window.location.href = "/Main";
		}, 2000);
	})
  }
</script>
<!-- ✅ 회원탈퇴 성공 모달 -->
<div id="successModal" style="display:none; position:fixed; top:30%; left:50%; transform:translate(-50%, -50%);
  background-color:white; padding:20px; border:1px solid #ccc; width:300px; text-align:center; box-shadow:0 0 10px rgba(0,0,0,0.3); z-index:1001;">
  <p style="font-weight:bold; color:green;">회원탈퇴가 완료되었습니다.</p>
</div>

<!-- ✅ 모달 배경 오버레이 -->
<div id="successOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.4); z-index:1000;"></div>


</body>
</html>
