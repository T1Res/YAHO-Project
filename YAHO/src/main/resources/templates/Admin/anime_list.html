<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>애니메이션 목록</title>
    <link rel="stylesheet" href="/CSS/AnimeMain.css">
    <link rel="stylesheet" href="/CSS/style.css">
    <script src="https://kit.fontawesome.com/071aa8f784.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="nav">
        <img src="/IMG/logo_test1.png">
        <div class="navitem" onclick="location.href='/Main'">홈</div>
        <div class="navitem" onclick="location.href='/List'">전체 애니</div>
        <div class="navitem" onclick="location.href='/Schedule/animeSchedule'">방영중 애니</div>
        <div class="navitem">자유게시판</div>
        <div class="navitem" onclick="location.href='/Admin/list'">관리자</div>
    </div>

    <br><br>

    <div class="main-layout">
        <!-- ✅ 사이드바(검색바) -->
        <aside class="sidebar">
            <form class="search-box" action="post" method="get" id="search-form">
                <input class="search-txt" type="text" name="keyword" id="search-input" placeholder="검색어를 입력하세요">
                <button class="search-btn" type="submit">
                    <i class="fa-duotone fa-solid fa-magnifying-glass"></i>
                </button>
            </form>

            <!-- 등록 모달 시작 -->
            <div class="tag-section">
                <div class="tag-list">
                    <!-- 등록 버튼 --><br>
                    <a href="#" class="tag-btn" id="open-insert" style="width: 100%; text-align: center; margin-bottom: 10px;">애니메이션 등록</a>

                    <!-- ✅ 통합 모달 -->
                    <div id="combinedModal" class="modal">
                        <div class="modal-content">
                            <span class="close-insert">&times;</span>
                            <form action="/Admin/insert_full" method="post" enctype="multipart/form-data">
                                <!-- 기본 정보 -->
                                <h4>기본 정보</h4>
                                <label for="TITLE">제목</label><br>
                                <input type="text" id="TITLE" name="TITLE" required><br><br>

                                <label for="THUMNAIL_GARO_URL">가로 이미지</label><br>
                                <input type="file" id="THUMNAIL_GARO_URL" name="THUMNAIL_GARO_URL" accept="image/*" onchange="previewImage(this, 'garoPreview')"><br>
                                <img id="garoPreview" style="max-width: 200px; display: none; margin-top: 10px;"><br><br>

                                <label for="THUMNAIL_SERO_URL">세로 이미지</label><br>
                                <input type="file" id="THUMNAIL_SERO_URL" name="THUMNAIL_SERO_URL" accept="image/*" onchange="previewImage(this, 'seroPreview')"><br>
                                <img id="seroPreview" style="max-height: 300px; display: none; margin-top: 10px;"><br><br>

                                <label>요일 (중복 선택 가능)</label><br>
                                <input type="checkbox" name="WEEKDAY" value="월요일"> 월요일
                                <input type="checkbox" name="WEEKDAY" value="화요일"> 화요일
                                <input type="checkbox" name="WEEKDAY" value="수요일"> 수요일
                                <input type="checkbox" name="WEEKDAY" value="목요일"> 목요일
                                <input type="checkbox" name="WEEKDAY" value="금요일"> 금요일
                                <input type="checkbox" name="WEEKDAY" value="토요일"> 토요일
                                <input type="checkbox" name="WEEKDAY" value="일요일"> 일요일<br><br>

                                <label for="SCORE">별점 (0.0 ~ 5.0)</label><br>
                                <input type="number" id="SCORE" name="SCORE" step="0.5" min="0" max="5" value="0" onkeydown="return false;" onfocus="this.blur();"><br><br>

                                <label for="TAGS">태그 (장르)</label><br>
                                <input type="text" id="TAGS" name="TAGS" placeholder="예: 판타지,액션"><br><br>

                                <!-- 상세 정보 -->
                                <h4>상세 정보</h4>
                                <label for="ANIME_DESC">줄거리</label><br>
                                <textarea id="ANIME_DESC" name="ANIME_DESC" rows="5" cols="40" required></textarea><br><br>

                                <label for="START_DATE">방영 시작일</label><br>
                                <input type="text" id="START_DATE" name="START_DATE"><br><br>

                                <label for="TOTAL_EPISODE">총 회차수</label><br>
                                <input type="text" id="TOTAL_EPISODE" name="TOTAL_EPISODE"><br><br>

                                <label for="CURRENT_EPISODE">현재 회차</label><br>
                                <input type="text" id="CURRENT_EPISODE" name="CURRENT_EPISODE"><br><br>

								<label for="STUDIO">제작사</label><br>
                                <input type="text" id="STUDIO" name="STUDIO"><br><br>

								<label for="STUDIO_LINK">제작사 링크</label><br>
                                <input type="text" id="STUDIO_LINK" name="STUDIO_LINK"><br><br>
                                
                                <label for="ANIME_SCORE">상세 별점 (0.0 ~ 5.0)</label><br>
                                <input type="number" id="ANIME_SCORE" name="ANIME_SCORE" step="0.5" min="0" max="5" value="0" onkeydown="return false;" onfocus="this.blur();"><br><br>

                                <label for="AGE_RATING">관람등급</label><br>
                                <input type="text" id="AGE_RATING" name="AGE_RATING"><br><br>

                                <button type="submit">등록</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 등록 모달 끝 -->
        </aside>
        <!-- 사이드바 끝 -->

        <div class="content-area">
            <!-- 정렬 시작 -->
            <div class="sort-bar">
                <div class="sort-dropdown">
                    <button class="sort-toggle">
                        <span class="current-sort">인기순</span> <span class="arrow">▴</span>
                    </button>
                    <ul class="sort-menu">
                        <li class="selected" data-sort="popular">인기순</li>
                        <li data-sort="asc">오름차순(A~ㅎ)</li>
                        <li data-sort="desc">내림차순(ㅎ~A)</li>
                        <li data-sort="new">신작순</li>
                        <li data-sort="update">업데이트순</li>
                        <li data-sort="review">리뷰 많은순</li>
                        <li data-sort="rating">별점 높은순</li>
                    </ul>
                </div>
            </div>
            <!-- 정렬 끝 -->
			
			<!-- 애니 제목 카드 리스트 -->
			<div class="anime-title-card-list">
			    <div class="anime-title-card"
			        th:each="item : ${mergedList}"
			        th:data-title="${item.ms.TITLE}"
			        th:data-id="${item.ms.ANIME_ID}"
			        th:data-garo-url="${item.ms.THUMNAIL_GARO_URL}"
			        th:data-sero-url="${item.ms.THUMNAIL_SERO_URL}"
			        th:data-weekday="${item.ms.WEEKDAY}"
			        th:data-score="${item.ms.SCORE}"
			        th:data-tags="${item.ms.TAGS}"
			        th:data-oc-id="${item.oc.ANIME_ID}"
			        th:data-desc="${item.oc.ANIME_DESC}"
			        th:data-start-date="${item.oc.START_DATE}"
			        th:data-total-episode="${item.oc.TOTAL_EPISODE}"
			        th:data-current-episode="${item.oc.CURRENT_EPISODE}"
			        th:data-studio="${item.oc.STUDIO}"
			        th:data-studio-link="${item.oc.STUDIO_LINK}"
			        th:data-oc-score="${item.oc.ANIME_SCORE}"
			        th:data-age-rating="${item.oc.AGE_RATING}"
			        th:text="${item.ms.TITLE}"
			        onclick="openEditModal(this)"
			        >
			    </div>
			</div>
			
			<!-- 애니 제목 카드 리스트 끝 -->
			
			<!-- 수정 모달 시작 -->
			<div id="editModal" class="modal">
			    <div class="modal-content">
			        <span class="close-first">&times;</span>
								
			        <!-- 수정 옵션 선택 -->
			        <div id="editOptions">
			            <h4>수정할 항목을 선택하세요:</h4>
			            <button onclick="openInfoEditForm()">정보 수정하기</button>
			            <button onclick="openDetailEditForm()">상세 정보 수정하기</button>
			            <button onclick="del()">삭제하기</button>
			        </div>
			        
			        <!-- 정보 수정 폼 -->
			        <div id="infoEditForm" style="display: none;">
			        
				    <form action="/Admin/edit_info" method="post">
				        <h4>기본 정보 수정</h4>
				
				        <input type="hidden" id="BASIC-ANIME_ID" name="ANIME_ID"> <!-- hidden ID 추가 -->
				
				        <label for="TITLE">제목</label><br>
				        <input type="text" id="BASIC-TITLE" name="TITLE" required><br><br>
				
				        <label for="THUMNAIL_GARO_URL">가로 이미지</label><br>
				        <input type="file" id="BASIC-THUMNAIL_GARO_URL" name="THUMNAIL_GARO_URL" accept="image/*"><br><br>
						<img id="preview-garo" src="" alt="가로 미리보기" style="max-width: 200px; display: block; margin-top: 10px;"><br><br>
				
				
				        <label for="THUMNAIL_SERO_URL">세로 이미지</label><br>
				        <input type="file" id="BASIC-THUMNAIL_SERO_URL" name="THUMNAIL_SERO_URL" accept="image/*"><br><br>
						<img id="preview-sero" src="" alt="세로 미리보기" style="max-width: 200px; display: block; margin-top: 10px;"><br><br>	
						
				        <label>요일</label><br>
				        <input type="checkbox" name="BASIC-WEEKDAY" value="월요일"> 월요일
				        <input type="checkbox" name="BASIC-WEEKDAY" value="화요일"> 화요일
				        <input type="checkbox" name="BASIC-WEEKDAY" value="수요일"> 수요일
				        <input type="checkbox" name="BASIC-WEEKDAY" value="목요일"> 목요일
				        <input type="checkbox" name="BASIC-WEEKDAY" value="금요일"> 금요일
				        <input type="checkbox" name="BASIC-WEEKDAY" value="토요일"> 토요일
				        <input type="checkbox" name="BASIC-WEEKDAY" value="일요일"> 일요일<br><br>
				
				        <label for="SCORE">별점</label><br>
				        <input type="number" id="BASIC-SCORE" name="SCORE" step="0.5" min="0" max="5" value="0"><br><br>
				
				        <label for="TAGS">태그 (장르)</label><br>
				        <input type="text" id="BASIC-TAGS" name="TAGS"><br><br>
				
				        <button type="submit">수정 완료</button>
				    </form>
				</div>
			
			        <!-- 상세 정보 수정 폼 -->
			        <div id="detailEditForm" style="display: none;">
			            <form action="/Admin/edit_detail" method="post">
			                <h4>상세 정보 수정</h4>
			
			                <label for="ANIME_DESC">줄거리</label><br>
			                <textarea id="DETAIL-ANIME_DESC" name="ANIME_DESC" rows="5" cols="40" required></textarea><br><br>
			
			                <label for="START_DATE">방영 시작일</label><br>
			                <input type="text" id="DETAIL-START_DATE" name="START_DATE"><br><br>
			
			                <label for="TOTAL_EPISODE">총 회차수</label><br>
			                <input type="text" id="DETAIL-TOTAL_EPISODE" name="TOTAL_EPISODE"><br><br>
			
			                <label for="CURRENT_EPISODE">현재 회차</label><br>
			                <input type="text" id="DETAIL-CURRENT_EPISODE" name="CURRENT_EPISODE"><br><br>
			
							<label for="STUDIO">제작사</label><br>
			                <input type="text" id="DETAIL-STUDIO" name="STUDIO"><br><br>
			
							<label for="STUDIO_LINK">제작사 링크</label><br>
			                <input type="text" id="DETAIL-STUDIO_LINK" name="STUDIO_LINK"><br><br>
			
			                <label for="ANIME_SCORE">상세 별점</label><br>
			                <input type="number" id="DETAIL-ANIME_SCORE" name="ANIME_SCORE" step="0.5" min="0" max="5" value="0"><br><br>
			
			                <label for="AGE_RATING">관람등급</label><br>
			                <input type="text" id="DETAIL-AGE_RATING" name="AGE_RATING"><br><br>
			                
			                
			
			                <button type="submit">수정 완료</button>
			            </form>
			        </div>
			        
			        <form id="deleteForm" action="/Admin/deleteAnime" method="post" style="display: none;">
			        	<input type="hidden" name="animeId" id="deleteAnimeId">
			        </form>
			    </div>
			</div>
			<!-- 수정 모달 끝 -->
			
			
			
        </div>
    </div>

</body>

<script>
    const dropdown = document.querySelector('.sort-dropdown');
    const toggleBtn = dropdown.querySelector('.sort-toggle');
    const sortMenu = dropdown.querySelector('.sort-menu');
    const sortItems = sortMenu.querySelectorAll('li');
    const currentSortText = dropdown.querySelector('.current-sort');

    // 드롭다운 열기/닫기
    toggleBtn.addEventListener('click', () => {
        dropdown.classList.toggle('open');
    });

    // 항목 클릭 시
    sortItems.forEach(item => {
        item.addEventListener('click', () => {
            // 기존 선택 해제
            sortItems.forEach(i => i.classList.remove('selected'));
            item.classList.add('selected');

            // 텍스트 표시 변경
            currentSortText.textContent = item.textContent;

            // 드롭다운 닫기
            dropdown.classList.remove('open');

            // 정렬 기준 값 추출
            const sortValue = item.getAttribute('data-sort');
            console.log("선택된 정렬 기준:", sortValue);

            // 정렬 함수 호출 (원하는 로직으로 연결)
            sortContent(sortValue);
        });
    });

    // 외부 클릭 시 닫기
    document.addEventListener('click', (e) => {
        if (!dropdown.contains(e.target)) {
            dropdown.classList.remove('open');
        }
    });

    // 예시: 콘텐츠 정렬 함수 (내용은 개발자가 정의)
    function sortContent(sortType) {
        // 예시용 출력
        console.log("정렬할 로직을 여기에 추가하세요. 현재 타입:", sortType);
        // 예: AJAX 호출 or DOM 정렬 등...
    }
</script>

<!-- 등록 모달 스크립트 시작 -->
<script>
    // 모달 열기
    document.getElementById("open-insert").onclick = function (e) {
        e.preventDefault();
        document.getElementById("combinedModal").style.display = "block";
    };

    // 모달 닫기
    document.querySelector(".close-insert").onclick = function () {
        document.getElementById("combinedModal").style.display = "none";
    };

    // 이미지 미리보기
    function previewImage(input, previewId) {
        const preview = document.getElementById(previewId);
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
                preview.style.display = "block";
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
<!-- 등록 모달 스크립트 끝 -->

<!-- 개열받네 -->
<script>
	function openEditModal(element) {
	    const animeId = element.getAttribute("data-id"); 
	    const animeTitle = element.getAttribute("data-title");
	    const garoUrl = element.getAttribute("data-garo-url");
	    const seroUrl = element.getAttribute("data-sero-url");
	    const weekday = element.getAttribute("data-weekday");
	    const score = element.getAttribute("data-score");
	    const tags = element.getAttribute("data-tags");
	    
	    const animeIdoc = element.getAttribute("data-oc-id"); 
	    const animeDesc = element.getAttribute("data-desc");
	    const animeSd = element.getAttribute("data-start-date");
	    const animeTe = element.getAttribute("data-total-episode");
	    const animeCe = element.getAttribute("data-current-episode");
	    const animeStdio = element.getAttribute("data-studio");
	    const animeLink = element.getAttribute("data-studio-link");
	    const animeScore = element.getAttribute("data-oc-score");
	    const animeAr = element.getAttribute("data-age-rating");
	    
	
	    currentAnimeId = element.getAttribute("data-id"); // <-- 여기에 animeId 저장
	    
	    // 모달 열기
	    document.getElementById('editModal').style.display = "block";
	
	    // 값 채우기 (폼은 보이기 전에도 미리 세팅)
	    document.getElementById('BASIC-ANIME_ID').value = animeId;
	    
	    document.getElementById('BASIC-TITLE').value = animeTitle;
	    
	    document.getElementById('BASIC-SCORE').value = score;
	    
	    document.getElementById('BASIC-TAGS').value = tags;
	
	    document.getElementById("preview-garo").src = garoUrl;
	    
	    document.getElementById("preview-sero").src = seroUrl;
	    
	    document.getElementById("BASIC-THUMNAIL_GARO_URL").addEventListener("change", function (e) {
	        const file = e.target.files[0];
	        if (file) {
	            document.getElementById("preview-garo").src = URL.createObjectURL(file);
	        }
	    });
	
	    document.getElementById("BASIC-THUMNAIL_SERO_URL").addEventListener("change", function (e) {
	        const file = e.target.files[0];
	        if (file) {
	            document.getElementById("preview-sero").src = URL.createObjectURL(file);
	        }
	    });
	    
	    // 요일 체크박스 초기화 후 설정
	    document.querySelectorAll('input[name="BASIC-WEEKDAY"]').forEach(cb => cb.checked = false);
	    if (weekday) {
	        const weekdays = weekday.split(',');
	        document.querySelectorAll('input[name="BASIC-WEEKDAY"]').forEach(cb => {
	            cb.checked = weekdays.includes(cb.value);
	        });
	    }
	    //기본 정보 값 채우기 끝
	    
	    //상세 정보 값 채우기
		document.getElementById('DETAIL-ANIME_DESC').value = animeDesc;
	    
	    document.getElementById('DETAIL-START_DATE').value = animeSd;
	    
	    document.getElementById('DETAIL-TOTAL_EPISODE').value = animeTe;
	    
	    document.getElementById('DETAIL-CURRENT_EPISODE').value = animeCe;
	    
	    document.getElementById('DETAIL-STUDIO').value = animeStudio;
	    
	    document.getElementById('DETAIL-STUDIO_LINK').value = animeLink;
	    
	    document.getElementById('DETAIL-ANIME_SCORE').value = animeScore;
	    
	    document.getElementById('DETAIL-AGE_RATING').value = animeAr;
	    
	    // 폼은 기본적으로 안 보이게 설정 (수정 버튼 클릭 시 보이게)
	    document.getElementById('infoEditForm').style.display = "none";
	    document.getElementById('detailEditForm').style.display = "none";
	    //끝
	}
	
	function closeModal() {
	    document.getElementById('editModal').style.display = "none";
	}
	
	document.addEventListener("DOMContentLoaded", () => {
	    const closeBtn = document.querySelector('.close-first');
	    if (closeBtn) {
	        closeBtn.onclick = closeModal;
	    }
	});
	
	function openInfoEditForm() {
	    document.getElementById('infoEditForm').style.display = "block";
	    document.getElementById('detailEditForm').style.display = "none";
	}
	
	function openDetailEditForm() {
	    document.getElementById('detailEditForm').style.display = "block";
	    document.getElementById('infoEditForm').style.display = "none";   
	}
	
	function del() {
	    if (confirm("삭제하시겠습니까?")) {
	        alert("삭제가 진행됩니다.");
	        document.getElementById("deleteAnimeId").value = currentAnimeId;
	        document.getElementById("deleteForm").submit();
	    } else {
	        alert("삭제가 취소되었습니다.");
	    }
	}
</script>
<!-- 진짜개열받기끝 -->

</html>
