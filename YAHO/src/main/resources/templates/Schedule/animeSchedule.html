<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì• ë‹ˆë©”ì´ì…˜ ë°©ì˜ ì‹œê°„í‘œ</title>
<link rel="stylesheet" href="/CSS/testSchedule.css">
<link rel="stylesheet" href="/CSS/test.css">
<link rel="stylesheet" th:href="@{/CSS/test3.css}">

<!-- ê¸€ê¼´ -->
<link
	href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap"
	rel="stylesheet">
</head>
<body>
	<div class="nav">
        <img src="/IMG/logo_test1.png">
        <div class="navitem" onclick="location.href='/Main'">í™ˆ</div>
        <div class="navitem" onclick="location.href='/List'">ì „ì²´ ì• ë‹ˆ</div>
        <div class="navitem" onclick="location.href='/Schedule/animeSchedule'">ë°©ì˜ì¤‘ ì• ë‹ˆ</div>
        
        <div class="navitem" onclick="location.href='/Admin/insert'">ê´€ë¦¬ì</div>
    </div>
    <br><br>
    
	<h1 class = "title-bar">ì• ë‹ˆë©”ì´ì…˜ ë°©ì˜ ì‹œê°„í‘œ</h1>
	
	<!-- ìƒë‹¨ ê³ ì • ìš”ì¼ ë°” -->
	<div class="day-title-bar">
		<div th:each="day : ${daysOfWeek}" class="day-title-cell"
			th:text="${day}">ì›”ìš”ì¼</div>
	</div>

	<div class="schedule-container">
		<!-- ìš”ì¼ë³„ ë°˜ë³µ -->
		<div th:each="day : ${daysOfWeek}" class="day-column">
			<div th:each="anime : ${animeByDay[day.trim()]}" class="anime-card"
				th:data-title="${anime.TITLE}" th:data-rating="${anime.SCORE}"
				th:data-image1="${anime.THUMNAIL_GARO_URL}"
				th:data-image2="${anime.THUMNAIL_SERO_URL}">

				<img th:src="${anime.THUMNAIL_SERO_URL}" alt="ì• ë‹ˆë©”ì´ì…˜ ì´ë¯¸ì§€">
				<div class="anime-title" th:text="${anime.TITLE}">ì œëª©</div>
				<div class="anime-rating" th:text="'â­ ' + ${anime.SCORE}">â­í‰ì </div>
			</div>
		</div>
	</div>

	<!-- ëª¨ë‹¬ -->
	<div id="animeModal" class="modal">
		<div class="modal_content">
			<span class="close" onclick="modal_close()">&times;</span>
			<div class="modal_div">

				<div class="modal_img">
					<img id="modal_img" src="" alt="ì´ë¯¸ì§€">
				</div>

				<div class="modal_title" id="modal_title"></div>

				<div class="modal_desc">
					<div class="desc_inf" id="modal_desc"></div>
				</div>

				<!-- í‰ì  ê²Œì‹œíŒ -->

				<div class="wrap">
					<div class="rating-container-row">
						<div class="rating-box">
							<h1>í‰ì  ê²Œì‹œíŒ</h1>
							<!-- íšŒì›ì´ ë²Œì¨ ì‘ì„±í•œ ë‚´ìš©ì´ ì¡´ì¬í•œë‹¤ë©´ ê°’ ë°›ì•„ì™€ì„œ í‰ì  ìˆ˜ì •-->
							<div id="rateFormArea">
								<div th:if="${!#strings.isEmpty(Aluser_ID)}">


									<input type="text" name="USER_ID" th:value="${Aldto.USER_ID}" />
									<input type="hidden" name="ANIME_ID"th:value="${Aldto.ANIME_ID}" />
									<!-- ìˆ˜ì •í¼ ì „ì²´ë¥¼ ê°ì‹¸ëŠ” ì˜ì—­ì—ë§Œ id ë¶€ì—¬ -->

									<!-- â­ ë³„ì  ì…ë ¥ ì˜ì—­ -->
									<div class="rating">
										<label class="rating__label rating__label--half"
											for="starhalf"> <input type="radio" id="starhalf"
											class="rating__input" name="SCORE_SCORE" value=0.5 /> <span
											class="star-icon"></span>
										</label> <label class="rating__label rating__label--full" for="star1">
											<input type="radio" id="star1" class="rating__input"
											name="SCORE_SCORE" value=1.0 /> <span class="star-icon"></span>
										</label> <label class="rating__label rating__label--half"
											for="star1half"> <input type="radio" id="star1half"
											class="rating__input" name="SCORE_SCORE" value=1.5 /> <span
											class="star-icon"></span>
										</label> <label class="rating__label rating__label--full" for="star2">
											<input type="radio" id="star2" class="rating__input"
											name="SCORE_SCORE" value=2.0 /> <span class="star-icon"></span>
										</label> <label class="rating__label rating__label--half"
											for="star2half"> <input type="radio" id="star2half"
											class="rating__input" name="SCORE_SCORE" value=2.5 /> <span
											class="star-icon"></span>
										</label> <label class="rating__label rating__label--full" for="star3">
											<input type="radio" id="star3" class="rating__input"
											name="SCORE_SCORE" value=3.0 /> <span class="star-icon"></span>
										</label> <label class="rating__label rating__label--half"
											for="star3half"> <input type="radio" id="star3half"
											class="rating__input" name="SCORE_SCORE" value=3.5 checked />
											<span class="star-icon"></span>
										</label> <label class="rating__label rating__label--full" for="star4">
											<input type="radio" id="star4" class="rating__input"
											name="SCORE_SCORE" value=4.0 /> <span class="star-icon"></span>
										</label> <label class="rating__label rating__label--half"
											for="star4half"> <input type="radio" id="star4half"
											class="rating__input" name="SCORE_SCORE" value=4.5 /> <span
											class="star-icon"></span>
										</label> <label class="rating__label rating__label--full" for="star5">
											<input type="radio" id="star5" class="rating__input"
											name="SCORE_SCORE" value=5.0 /> <span class="star-icon"></span>
										</label>
									</div>
									<br>
									<!-- ğŸ“ ëŒ“ê¸€ ì…ë ¥ì°½ -->
									<div style="margin-top: 20px;">
										<textarea name="SCORE_CONTENT" rows="4" cols="50"
											th:text="${Aldto.SCORE_CONTENT}"></textarea>
									</div>

									<!-- ìˆ˜ì •ë²„íŠ¼ -->

									<button type="button" onclick="updateRate()">ìˆ˜ì •</button>

									
										<!-- ì‚­ì œë²„íŠ¼ -->
										<input type="hidden" name="USER_ID"th:value="${Aldto.USER_ID}" /> 
										<input type="hidden"name="ANIME_ID" th:value="${Aldto.ANIME_ID}" />
										<button type="button" onclick="deleteRate()">ì‚­ì œ</button>
									
									<hr style="margin-top: 20px;" />
								</div>
							</div>
							<!-- íˆë“  -->
							<input type="hidden" id="userId" name="USER_ID"
								th:value="${USER_ID}" /> <input type="hidden" id="animeId"
								name="ANIME_ID" value="999" />
								
							<div id="registerFormArea">
							<div th:if="${#strings.isEmpty(Aluser_ID)}">
							<!-- ê¸°ì¡´ form íƒœê·¸ ì œê±° -->
							

							<div class="rating-container-row"></div>

							<!-- radio, textareaëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ -->
							<!-- â­ ë³„ì  ì…ë ¥ ì˜ì—­ -->
							<div class="rating">
								<label class="rating__label rating__label--half" for="starhalf">
									<input type="radio" id="starhalf" class="rating__input"
									name="SCORE_SCORE" value=0.5 /> <span class="star-icon"></span>
								</label> <label class="rating__label rating__label--full" for="star1">
									<input type="radio" id="star1" class="rating__input"
									name="SCORE_SCORE" value=1.0 /> <span class="star-icon"></span>
								</label> <label class="rating__label rating__label--half"
									for="star1half"> <input type="radio" id="star1half"
									class="rating__input" name="SCORE_SCORE" value=1.5 /> <span
									class="star-icon"></span>
								</label> <label class="rating__label rating__label--full" for="star2">
									<input type="radio" id="star2" class="rating__input"
									name="SCORE_SCORE" value=2.0 /> <span class="star-icon"></span>
								</label> <label class="rating__label rating__label--half"
									for="star2half"> <input type="radio" id="star2half"
									class="rating__input" name="SCORE_SCORE" value=2.5 /> <span
									class="star-icon"></span>
								</label> <label class="rating__label rating__label--full" for="star3">
									<input type="radio" id="star3" class="rating__input"
									name="SCORE_SCORE" value=3.0 /> <span class="star-icon"></span>
								</label> <label class="rating__label rating__label--half"
									for="star3half"> <input type="radio" id="star3half"
									class="rating__input" name="SCORE_SCORE" value=3.5 checked />
									<span class="star-icon"></span>
								</label> <label class="rating__label rating__label--full" for="star4">
									<input type="radio" id="star4" class="rating__input"
									name="SCORE_SCORE" value=4.0 /> <span class="star-icon"></span>
								</label> <label class="rating__label rating__label--half"
									for="star4half"> <input type="radio" id="star4half"
									class="rating__input" name="SCORE_SCORE" value=4.5 /> <span
									class="star-icon"></span>
								</label> <label class="rating__label rating__label--full" for="star5">
									<input type="radio" id="star5" class="rating__input"
									name="SCORE_SCORE" value=5.0 /> <span class="star-icon"></span>
								</label>
							</div>
							<br>
							<!-- ğŸ“ ëŒ“ê¸€ ì…ë ¥ì°½ -->
							<div style="margin-top: 20px;">
								<textarea name="SCORE_CONTENT" rows="4" cols="50"
									placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"></textarea>
							</div>
							<!-- ë“±ë¡(Ajaxí…ŒìŠ¤íŠ¸) ë²„íŠ¼ -->
							<button type="button" onclick="submitRate()">ë“±ë¡</button>

						</div>
						</div>
</div>

						<!-- í†µê³„ -->

						<div class="rating-box2">

							<div class="stats-row">

								<!-- í‰ì  ìˆ«ì -->
								<div class="grade-section">
									<span style="font-size: 30px;" th:text=${grade}></span><br>
									<span class="grade-badge" th:text="${gradeMark}"></span>
								</div>

								<!-- ë§‰ëŒ€ ê·¸ë˜í”„ -->
								<div class="chart-section">
									<canvas id="myChart"></canvas>
								</div>

								<!-- ë„ë„› ì°¨íŠ¸ -->
								<div class="chart-section donut-section">
									<canvas id="genderChart"></canvas>
								</div>

							</div>
						</div>

					</div>
				</div>
				
				<!-- í‰ì  ê²Œì‹œíŒ ëª©ë¡ -->

				<div class="wrap">
					<h1>ê²Œì‹œíŒ ëª©ë¡</h1>


					<!-- ë¦¬ìŠ¤íŠ¸ ë°˜ë³µ -->
					<div th:each="dto : ${list}" style="margin-bottom: 20px;">

						<!-- ì‚¬ìš©ì ì•„ì´ë”” -->
						<div style="color: white;">
							<strong th:text="${dto.USER_ID}">ì‘ì„±ì</strong> :
						</div>

						<!-- ë³„ì  í‘œì‹œ -->
						<div style="color: gold; font-size: 20px; margin-top: 4px;">
							<span th:if="${dto.SCORE_SCORE == 0.5}"> <img
								src="/IMG/star_half.png" width="20" height="20" />
							</span> <span th:if="${dto.SCORE_SCORE == 1}"> <img
								src="/IMG/star_full.png" width="20" height="20" />
							</span> <span th:if="${dto.SCORE_SCORE == 1.5}"> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_half.png" width="20" height="20" />
							</span> <span th:if="${dto.SCORE_SCORE == 2}"> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_full.png" width="20" height="20" />
							</span> <span th:if="${dto.SCORE_SCORE == 2.5}"> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_half.png" width="20" height="20" />
							</span> <span th:if="${dto.SCORE_SCORE == 3}"> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_full.png" width="20" height="20" />
							</span> <span th:if="${dto.SCORE_SCORE == 3.5}"> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_half.png" width="20" height="20" />
							</span> <span th:if="${dto.SCORE_SCORE == 4}"> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_full.png" width="20" height="20" />
							</span> <span th:if="${dto.SCORE_SCORE == 4.5}"> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_half.png" width="20" height="20" />
							</span> <span th:if="${dto.SCORE_SCORE == 5}"> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_full.png" width="20" height="20" /> <img
								src="/IMG/star_full.png" width="20" height="20" />
							</span>
						</div>

						<!-- ëŒ“ê¸€ ë‚´ìš© -->
						<div style="color: white;">
							<div style="margin-top: 4px;">
								<span th:text="${dto.SCORE_CONTENT}">ëŒ“ê¸€</span>
							</div>
						</div>
						<form th:action="@{/Schedule//updateRate}" method="post">
							<input type="text" name="USER_ID" th:value="${dto.USER_ID}" /> <input
								type="hidden" name="ANIME_ID" th:value="${dto.ANIME_ID}" />

						</form>
						<hr style="margin-top: 20px;" />
					</div>
				</div>


			</div>
		</div>
	</div>
	<script src="/JS/chart.umd.js"></script>
	<!-- ë“±ë¡ Ajax -->
	<script src="/JS/submitTest.js"></script>
	<!-- ìˆ˜ì • Ajax -->
	<script src="/JS/updateTest.js"></script>
	<!-- ë„ë„› -->
	<script src="/JS/genderChart.js"></script>
	<!-- ë³„ì  ê¸°ëŠ¥ -->
	<script src="/JS/Rating.js"></script>
	<!-- í†µê³„ -->

	<script th:inline="javascript">
    /*<![CDATA[*/
        let voteLabels = /*[[${scoreList}]]*/ [];
        let voteCounts = /*[[${countList}]]*/ [];
    /*]]>*/
    </script>

	<script>
    const ctx2 = document.getElementById('myChart').getContext('2d');

    // âœ… ì „ì—­ì— ë“±ë¡
    window.myChart = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: voteLabels,
            datasets: [{
                label: 'í‰ì  ë¶„í¬',
                data: voteCounts,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.6)',   // 0~1
                    'rgba(54, 162, 235, 0.6)',   // 1~2
                    'rgba(255, 206, 86, 0.6)',   // 2~3
                    'rgba(75, 192, 192, 0.6)',   // 3~4
                    'rgba(153, 102, 255, 0.6)'   // 4~5
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)'
                ],
                borderWidth: 1,
                barPercentage: 0.5,
                categoryPercentage: 0.5
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
	<!-- ë„ë„› í•¨ìˆ˜ -->
	<script th:inline="javascript">
/*<![CDATA[*/
  const maleRatio = /*[[${maleRatio}]]*/ 50;
  const femaleRatio = /*[[${femaleRatio}]]*/ 50;
/*]]>*/
</script>



</body>
<script>
    // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
	function refreshPage() {
		window.location.reload();
	}
	
    // ì• ë‹ˆë©”ì´ì…˜ ì œëª© ì¶•ì•½
	document.addEventListener("DOMContentLoaded", function () {
        const maxLength = 10; // ìµœëŒ€ ê¸€ì ìˆ˜ (ì›í•˜ëŠ” ê°’ìœ¼ë¡œ ë³€ê²½)

        document.querySelectorAll(".anime-title").forEach(titleElement => {
            let fullTitle = titleElement.textContent.trim(); // ì›ë˜ ì œëª© ê°€ì ¸ì˜¤ê¸°
            
            if (fullTitle.length > maxLength) {
                titleElement.setAttribute("data-title", fullTitle); // data-titleì— ì›ì œëª© ì €ì¥
                titleElement.textContent = fullTitle.substring(0, maxLength) + "..."; // ì¶•ì•½ í›„ í‘œì‹œ
            }
        });
    });
    
    
    
	// í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
	document.querySelectorAll(".anime-card").forEach(card => {
        card.addEventListener("click", function () {
            const title = card.getAttribute("data-title");
            const rating = card.getAttribute("data-rating");
            const image1 = card.getAttribute("data-image1");
            const image2 = card.getAttribute("data-image2");
            let desc = "ì´ê²ƒì€ ìŠ¤í¬ë¡¤ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤.\n\n\n\n\n\n\n\n\n\n";
        	desc += "ì—¬ê¸°ì— ë” ë§ì€ ì¤„ë°”ê¿ˆì„ ì¶”ê°€í•©ë‹ˆë‹¤.\n\n\n\n\n\n\n\n\n\n";
        	desc += "ì´ì œ ëª¨ë‹¬ ì°½ì—ì„œ ìŠ¤í¬ë¡¤ì´ ì˜ ë˜ëŠ”ì§€ í™•ì¸í•´ ë³´ì„¸ìš”!";
            
            // ëª¨ë‹¬ ìš”ì†Œì— ê°’ ë„£ê¸°
            document.querySelector("#modal_title").textContent = title;
            //document.querySelector("#modal-rating").textContent = "â­ " + rating;
            document.querySelector("#modal_img").src = image1; // ì´ë¯¸ì§€2(ê°€ë¡œ) ì‚¬ìš©
			document.querySelector("#modal_desc").innerText = desc;
            
            // ëª¨ë‹¬ ì—´ê¸°
            document.querySelector("#animeModal").style.display = "block";
            
         	// ëª¨ë‹¬ ë‚´ë¶€ ìŠ¤í¬ë¡¤ ì´ˆê¸°í™”
            document.querySelector(".modal_content").scrollTop = 0;
        });
    });
  
 	// ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
    function modal_close() {
        document.getElementById("animeModal").style.display = "none";
    }

    // ëª¨ë‹¬ ë°”ê¹¥ ì˜ì—­ í´ë¦­ ì‹œ ë‹«ê¸° ê¸°ëŠ¥ ì¶”ê°€
    window.onclick = function(event) {
        let modal = document.getElementById("animeModal");
        if (event.target === modal) {  // ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ ì‹œ
            modal_close();  // ëª¨ë‹¬ ë‹«ê¸° ì‹¤í–‰
        }
    };
</script>
</html>
