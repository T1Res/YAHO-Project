<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<!-- Swiper CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YAHO</title>

    <link rel="stylesheet" href="/CSS/AnimeMain.css">
    <link rel="stylesheet" href="/CSS/info.css">
	  <link rel="stylesheet" href="/CSS/footer.css">
    <!-- ìƒì„¸í˜ì´ì§€ Css -->
    <link rel="stylesheet" th:href="@{/CSS/test3.css}">
    
<!-- favicon -->
<link rel="icon" href="IMG/favicon/favicon.ico" type="image/x-icon">

<!-- ì•„ì´ì½˜ -->
<script src="https://kit.fontawesome.com/071aa8f784.js" crossorigin="anonymous"></script>
<!-- íˆ¬í‘œ ì°¨íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<!-- ì˜¤ë””ì˜¤ íƒœê·¸ -->
<audio id="audioPlayer" hidden autoplay></audio>

<!-- JSì—ì„œ ì°¸ì¡°í•  ì „ì—­ë³€ìˆ˜ ì„¤ì • -->
<script th:inline="javascript">
    /*<![CDATA[*/
    window.playAudioFlag = /*[[${playAudio}]]*/ false;
    /*]]>*/
</script>
<!-- ì˜¤ë””ì˜¤ ì¬ìƒ ìŠ¤í¬ë¦½íŠ¸ ì™¸ë¶€ í¬í•¨ -->
<script src="/js/audio-play.js"></script>

<body>
    <div th:replace="~{fragments/nav :: navbar}"></div>

    <br><br>
    
    <div class="title" style="background-color: black;">
        <img src="" alt="">
	</div>
	
	<hr class="custom-hr"><br>

	<h2 style="color:#ffffff;"> &nbsp; - ê°œë°œì ì—„ì„  ì¶”ì²œ ì• ë‹ˆ</h2>
	<br>
	
	<!-- carousel ì‹œì‘ -->
	<div class="carousel_main">
		<div class="carousel_wrapper">
			<div class="carousel_slide">
				<img src="IMG/Recommended/ì¶”ì²œì• ë‹ˆ_ë§ˆë²•ì‚¬ì˜ ì‹ ë¶€.png" />
				<div class="slide-title">ë§ˆë²•ì‚¬ì˜ ì‹ ë¶€</div>
			</div>
			<div class="carousel_slide">
				<img src="IMG/Recommended/ì¶”ì²œì• ë‹ˆ_ê¿ˆë¹›íŒŒí‹°ì‹œì—˜.png" />
				<div class="slide-title">ê¿ˆë¹› íŒŒí‹°ì‹œì—˜</div>
			</div>
			<div class="carousel_slide">
				<img src="IMG/Recommended/ì¶”ì²œì• ë‹ˆ_ë„ë¼ì—ëª½.png" />
				<div class="slide-title">ë„ë¼ì—ëª½</div>
			</div>
			<div class="carousel_slide">
				<img src="IMG/Recommended/ì¶”ì²œì• ë‹ˆ_ë¶ˆê½ƒì†Œë°©ëŒ€.png" />
				<div class="slide-title">ë¶ˆê½ƒ ì†Œë°©ëŒ€</div>
			</div>
			<div class="carousel_slide">
				<img src="IMG/Recommended/ì¶”ì²œì• ë‹ˆ_ì˜¤ì™€ë¦¬ëª¨ë…¸ê°€íƒ€ë¦¬.jpg" />
				<div class="slide-title">ì˜¤ì™€ë¦¬ëª¨ë…¸ê°€íƒ€ë¦¬</div>
			</div>
			<div class="carousel_slide">
				<img src="IMG/Recommended/ì¶”ì²œì• ë‹ˆ_ì¼í•˜ëŠ”ì„¸í¬.png" />
				<div class="slide-title">ì¼í•˜ëŠ” ì„¸í¬</div>
			</div>
			<div class="carousel_slide">
				<img src="IMG/Recommended/ì¶”ì²œì• ë‹ˆ_ì£¼ìˆ íšŒì „.png" />
				<div class="slide-title">ì£¼ìˆ íšŒì „</div>
			</div>
			<div class="carousel_slide">
				<img src="IMG/Recommended/ì¶”ì²œì• ë‹ˆ_ì½”ë…¸ìŠ¤ë°”.png" />
				<div class="slide-title">ì´ ë©‹ì§„ ì„¸ê³„ì— ì¶•ë³µì„ !</div>
			</div>
		</div>
		
		<div class="carousel_button_container">
			<button type="button" class="carousel_prev">
				<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50"
					fill="currentColor" class="bi bi-chevron-double-left"
					viewBox="0 0 16 16">
                <path fill-rule="evenodd"
						d="M8.354 1.646a.5.5 0 0 1 0 .708L2.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z" />
                <path fill-rule="evenodd"
						d="M12.354 1.646a.5.5 0 0 1 0 .708L6.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z" />
            </svg>
			</button>
			<button type="button" class="carousel_next">
				<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50"
					fill="currentColor" class="bi bi-chevron-double-right"
					viewBox="0 0 16 16">
                <path fill-rule="evenodd"
						d="M3.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L9.293 8 3.646 2.354a.5.5 0 0 1 0-.708z" />
                <path fill-rule="evenodd"
						d="M7.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L13.293 8 7.646 2.354a.5.5 0 0 1 0-.708z" />
            </svg>
			</button>
		</div>
		<div class="carousel_pagination">
			<div class="carousel_circle"></div>
			<div class="carousel_circle"></div>
			<div class="carousel_circle"></div>
			<div class="carousel_circle"></div>
			<div class="carousel_circle"></div>
			<div class="carousel_circle"></div>
			<div class="carousel_circle"></div>
			<div class="carousel_circle"></div>
		</div>
	</div>
	<!-- carousel ë -->

	<hr class="custom-hr"><br>
	
	<h2 style="color:#ffffff;"> &nbsp; - ì˜¤ëŠ˜ì˜ ì• ë‹ˆ</h2>
	<div class="swiper-container">
		<div class="swiper-wrapper" >
			<div class="swiper-slide" 
				th:each="anime : ${animeList}"
				th:data-anime-id="${anime.animeId}"
     			onclick="openModalDetail(this)">
     			
				<!-- camelCaseë¡œ THUMBNAIL_GARO_URLì„ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•´ë†¨ìŒ -->
				<img th:src="${anime.thumnailGaroUrl}" alt="ì´ë¯¸ì§€1">
				<div class="slide-title" th:text = "${anime.title}"></div>
			</div>
		</div>
		<!-- ì¢Œìš° í™”ì‚´í‘œ -->
		<div class="swiper-button-prev"></div>
		<div class="swiper-button-next"></div>
	</div>

	<hr class="custom-hr"><br>
	
	<!-- ìœ íŠœë¸Œ -->
	<h2 style="color:#ffffff;"> &nbsp; - YouTube</h2>
	<div class="swiper-container-youtube">
	    <div class="swiper-wrapper">
	        <!-- ì˜ìƒ 1 -->
	        <div class="swiper-slide">
	            <div class="youtube-thumbnail" data-video-id="9FCX_7tCcrk">
	                <img src="https://img.youtube.com/vi/9FCX_7tCcrk/0.jpg" alt="YouTube ì¸ë„¤ì¼">
	                <div class="play-button">â–¶</div>
	            </div>
	        </div>
	
	        <!-- ì˜ìƒ 2 -->
	        <div class="swiper-slide">
	            <div class="youtube-thumbnail" data-video-id="GjfSwJlq4rk">
	                <img src="https://img.youtube.com/vi/GjfSwJlq4rk/0.jpg" alt="YouTube ì¸ë„¤ì¼">
	                <div class="play-button">â–¶</div>
	            </div>
	        </div>
	
	        <!-- ì˜ìƒ 3 -->
	        <div class="swiper-slide">
	            <div class="youtube-thumbnail" data-video-id="BGlQakaaJDs">
	                <img src="https://img.youtube.com/vi/BGlQakaaJDs/0.jpg" alt="YouTube ì¸ë„¤ì¼">
	                <div class="play-button">â–¶</div>
	            </div>
	        </div>
	
	        <!-- ì˜ìƒ 4 -->
	        <div class="swiper-slide">
	            <div class="youtube-thumbnail" data-video-id="w1J9aH9DhrY">
	                <img src="https://img.youtube.com/vi/w1J9aH9DhrY/0.jpg" alt="YouTube ì¸ë„¤ì¼">
	                <div class="play-button">â–¶</div>
	            </div>
	        </div>
	
	        <!-- ì˜ìƒ 5 -->
	        <div class="swiper-slide">
	            <div class="youtube-thumbnail" data-video-id="ptc0YXw9ZOo">
	                <img src="https://img.youtube.com/vi/ptc0YXw9ZOo/0.jpg" alt="YouTube ì¸ë„¤ì¼">
	                <div class="play-button">â–¶</div>
	            </div>
	        </div>
	
	        <!-- ì˜ìƒ 6 -->
	        <div class="swiper-slide">
	            <div class="youtube-thumbnail" data-video-id="VYFsjzOmJhk">
	                <img src="https://img.youtube.com/vi/VYFsjzOmJhk/0.jpg" alt="YouTube ì¸ë„¤ì¼">
	                <div class="play-button">â–¶</div>
	            </div>
	        </div>
	
	    </div>
	
	    <!-- ì¢Œìš° í™”ì‚´í‘œ -->
	    <div class="swiper-button-prev"></div>
	    <div class="swiper-button-next"></div>
	</div>

	
	<hr class="custom-hr"><br>

	<!-- ë©”ì¸ í•˜ë‹¨ -->
	<div class="main-bottom-wrapper">
	    <!-- ì™¼ìª½ : ì¸ê¸° ë­í‚¹ -->
	    <div class="ranking-section">
	        <h2 style = "color: #fff;">ğŸ”¥ ì¸ê¸° ì• ë‹ˆ ë­í‚¹ Top 10</h2>
	        <div class="swiper-container-ranking">
	            <div class="swiper-wrapper">
	                <div class="swiper-slide" th:each="anime, iterStat : ${animeListTop10}">
	                    <div class="rank-card"
     						th:classappend="${iterStat.count == 1 ? 'rank-1' : (iterStat.count == 2 ? 'rank-2' : (iterStat.count == 3 ? 'rank-3' : 'rank-others'))}"
     						th:data-anime-id="${anime.animeId}"
     						onclick="openModalDetail(this)">
							<div class="rank-number" th:text="${iterStat.count}"></div>
	                        <img th:src="${anime.thumnailSeroUrl}" alt="ì¸ë„¤ì¼" class="rank-thumbnail">
	                        <div class="rank-info">
	                            <div class="rank-title" th:text="${anime.title}">ì• ë‹ˆ ì œëª©</div>
	                            <div class="rank-score" th:text="${anime.score} + 'ì '">9.5ì </div>
	                        </div>
	                    </div>
	                </div>
	            </div>
	        </div>
	    </div>
	
	    <!-- ì˜¤ë¥¸ìª½ -->
	    <div class="vote-section">
		    
		</div>
	</div>
	
	<hr class="custom-hr"><br>
	
	<!-- ëª¨ë‹¬ -->
	<div id="animeModal" class="modal">
		<div class="modal_content">
			<span class="close" onclick="modal_close()">&times;</span>
			<div class="modal_div">

				<div class="modal_img">
					<img id="modal_img" src="" alt="ì´ë¯¸ì§€">
				</div>
				
				<!-- ì• ë‹ˆ ìƒì„¸ ì •ë³´ -->
				<div class="anime-info-container">
					<div class="ani-content">
						<section class="ani-section">
							<div class="ani-row">
								<h2>ì• ë‹ˆì œëª©</h2>
								<p id="anime_title"></p>
							</div>
							
							<div class="ani-row">
								<h2>ë°©ì˜ì¼</h2>
								<p id="start_date"></p>
							</div>
							
							<div class="ani-row">
								<h2>ë°©ì˜ì°¨ìˆ˜</h2>
								<p id="total_episode"></p>
							</div>
							
							<div class="ani-row">
								<h2>ì œì‘ì‚¬</h2>
								<p id="studio">ì œì‘ì‚¬1</p>
							</div>
							
							<div class="ani-row">
								<h2>ìƒì˜ë“±ê¸‰</h2>
								<p id="age_rating"></p>
							</div>
							
							<div class="ani-summary">
								<h2>ì• ë‹ˆ ì¤„ê±°ë¦¬</h2>
								<p id="anime_desc">ì¤„ê±°ë¦¬ ë‚´ìš©</p>
								<span id="summaryButton" class="toggle-btn">ë”ë³´ê¸°</span>
							</div>
						</section>
					</div>
				</div>
				<!-- í‰ì  ë“±ë¡ ìˆ˜ì • ë¶€ë¶„ -->
				<div class="wrap">
				  <div class="rating-container-row">
				    <div class="rating-box">
				      <h1>í‰ì  ê²Œì‹œíŒ</h1>
				
				      <!-- ìˆ˜ì • ì˜ì—­: ìœ ì €ê°€ ì´ë¯¸ í‰ê°€í•œ ê²½ìš°ì—ë§Œ í‘œì‹œ -->
				      <div id="rateFormArea" style="display: none;">
				        <img src="/IMG/kibon_image.jpg" class="profile-img"/>
				        <div class="user-id" th:text="${USER_ID}"></div><input type="hidden" id="rated_user_id" name="USER_ID" th:value="${USER_ID}" />
				        <input type="hidden" id="rated_anime_id" name="ANIME_ID"/>
						<br>
						
				        <!-- ë³„ì  ì…ë ¥ -->
				        <div class="rating" id="rated_stars_area"></div>
				
				        <!-- ëŒ“ê¸€ ì…ë ¥ -->

								<div style="margin-top: 20px;">
									<textarea id="rated_content" rows="4" cols="50" maxlength="100"></textarea>

									<!-- ë²„íŠ¼ì„ ê°€ë¡œë¡œ ì •ë ¬ -->
									<div class="button-container">
										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
										<button type="button" onclick="updateRate()">ìˆ˜ì •</button>
										<button type="button" onclick="deleteRate()">ì‚­ì œ</button>
										<div id="rated_charCount" class="char-count">0/100</div>
										<!-- ê¸€ììˆ˜ ì¹´ìš´íŠ¸ëŠ” ì˜¤ë¥¸ìª½ ëì— ìœ„ì¹˜ -->
									</div>
								</div>




							</div>
				
				      <!-- ë“±ë¡ ì˜ì—­: í‰ê°€ë¥¼ ì•ˆ í–ˆì„ ë•Œë§Œ í‘œì‹œ -->
							<div id="registerFormArea" style="display: none;">
								<input type="hidden" id="register_anime_id" name="ANIME_ID" /> <img
									src="/IMG/kibon_image.jpg" class="profile-img" />
								<div class="user-id" th:text="${USER_ID}"></div>
								<input type="hidden" id="register_user_id" name="USER_ID"th:value="${USER_ID}" /> <br>
								<div class="rating" id="register_stars_area"></div>

								<div style="margin-top: 20px;">
									<textarea id="register_content" rows="4" cols="50"
										maxlength="100"></textarea>

								</div>
								<div class="button-container">
									&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
									&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
									&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
									&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
									&nbsp;&nbsp;&nbsp;&nbsp;
									<button type="button" onclick="submitRate()">ë“±ë¡</button>
									<div id="register_charCount" class="char-count">0/100</div>
								</div>
							</div>

						</div>
				
				    <!-- í†µê³„ -->
				    <div class="rating-box2">
				     <h1>í†µê³„</h1>
				     <br>
				     <br>
				     <br>
				     
				      <div class="stats-row">
				        <div class="grade-section">
				          &nbsp;&nbsp;&nbsp;&nbsp;
				          <span id="grade-number" style="font-size: 50px;"></span><br>
				          <span class="grade-badge" id="grade-mark"></span>
				        </div>
				
				        <div class="chart-section">
				          <canvas id="myChart"></canvas>
				        </div>
				
				        <div class="chart-section donut-section">
				          <canvas id="genderChart"></canvas>
				        </div>
				      </div>
				    </div>
				  </div>
				</div>
				
				<!-- ëŒ“ê¸€ ëª©ë¡ ì˜ì—­ -->
				<div class="wrap2" id="comment-list-area">
				  <h1>ê²Œì‹œíŒ ëª©ë¡</h1>
				  <!-- JSì—ì„œ ë™ì ìœ¼ë¡œ ì‚½ì… -->
				</div>
				
				
			</div>
		</div>
	</div>
	
	<footer class = "footer-wrapper">
		<div class="footer-content">
			<div class="col left">
				<ul class="footer-nav">
					<li><a href="/Info/teamInfo">ì‚¬ì´íŠ¸ì†Œê°œ</a></li>
					<li><a href="#">ì´ìš©ì•½ê´€</a></li>
					<li><a href="#">ê°œì¸ì •ë³´ ì·¨ê¸‰ë°©ì¹¨</a></li>
					<li><a href="#">ì´ìš©ì•ˆë‚´</a></li>
				</ul>
				<hr>
				<div class="footer-info">
					<p>ìƒí˜¸: NJM (ëŒ€í‘œ : ì¡°í˜œë¦¼)</p>
					<p>ì£¼ì†Œ: ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ê³„ë£¡ë¡œ 825 JSLì¸ì¬ê°œë°œì›</p>
					<p>ì „í™”: 010-1111-2222</p>
					<p>ì‚¬ì—…ìë“±ë¡ì „í™”: 000-00-00000</p>
				</div>
			</div>
			<div class="col center">
				<h2>ê³ ê°ì„¼í„°</h2>
				<h3>032-0000-0000</h3>
				<p>ì›”-ê¸ˆ 10:00-18:00</p>
				<ul class="socials">
					<li><a href="https://www.instagram.com/"><i class="fa-brands fa-instagram"></i></a></li>
					<li><a href="https://www.facebook.com/"><i class="fa-brands fa-square-facebook"></i></a></li>
					<li><a href="https://www.youtube.com/"><i class="fa-brands fa-youtube"></i></a></li>
				</ul>
			</div>
			<div class="col right">
				<h2>ì»¤ë®¤ë‹ˆí‹°</h2>
				<p><a href="#">ê³µì§€ì‚¬í•­</a></p>
				<p><a href="#">ê²Œì‹œíŒ</a></p>
				<p><a href="#">NEW</a></p>
			</div>	
		</div>
		<div class="copyright">
			<p>Copyright &copy; YAHO. All rights reserved.
		</div>
	</footer>
	
  <script src="/JS/chart.umd.js"></script>
	<script src="/JS/Rating3.js"></script>ë¡œ HTMLì— ë“±ë¡
	<!-- ë„ë„› -->
	<script src="/JS/genderChart.js"></script>
	<!-- ë³„ì  ê¸°ëŠ¥ -->
	<script src="/JS/Rating.js"></script>
	<!-- í†µê³„ -->
	<script th:inline="javascript">
    /*<![CDATA[*/
        let voteLabels = /*[[${scoreList}]]*/ [];
        let voteCounts = /*[[${countList}]]*/ [];
    /*]]>*/
    </script>
	<script>
    const ctx2 = document.getElementById('myChart').getContext('2d');

    // âœ… ì „ì—­ì— ë“±ë¡
    window.myChart = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: voteLabels,
            datasets: [{
                label: 'í‰ì  ë¶„í¬',
                data: voteCounts,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.6)',   // 0~1
                    'rgba(54, 162, 235, 0.6)',   // 1~2
                    'rgba(255, 206, 86, 0.6)',   // 2~3
                    'rgba(75, 192, 192, 0.6)',   // 3~4
                    'rgba(153, 102, 255, 0.6)'   // 4~5
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)'
                ],
                borderWidth: 1,
                barPercentage: 0.5,
                categoryPercentage: 0.5
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
<!-- ë„ë„› í•¨ìˆ˜ -->
	<script th:inline="javascript">
/*<![CDATA[*/
  const maleRatio = /*[[${maleRatio}]]*/ 50;
  const femaleRatio = /*[[${femaleRatio}]]*/ 50;
/*]]>*/
</script>

	<!-- Swiper JS -->
	<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>  
</body>
<script th:inline="javascript">
	function openModalDetail(el) {
		const animeId = el.getAttribute("data-anime-id");
		const userId = /*[[${USER_ID}]]*/ '';  
		// Thymeleafê°€ `${USER_ID}`ë¥¼ ì—¬ê¸°ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
		 // ë¡œê·¸ì¸ ì¤‘ì¸ ìœ ì € ID, í˜„ì¬ ì•„ì§ ê¸°ëŠ¥ì´ ì—†ìœ¼ë¯€ë¡œ ì„ì‹œë¡œ aa1111ë¡œ ì„¤ì •
		

		<!-- console.log("ì• ë‹ˆ ID,ìœ ì € ID: ", animeId,userId); -->
		
		// ê¸°ë³¸ ì •ë³´ ë¡œë”©
		fetch(`Main/anime/baseInfo?animeId=${animeId}`)
		    .then(res => res.json())
		    .then(data => {
	            console.log("ê¸°ë³¸ ì •ë³´:", data);
		        const titleEl = document.getElementById("anime_title");
		        const animeGaroImgEl = document.getElementById("modal_img");
		
		        if (titleEl) titleEl.innerText = data.title || "ì œëª© ì—†ìŒ";
		        if (animeGaroImgEl) animeGaroImgEl.setAttribute("src", data.thumnailGaroUrl || "IMG/default.png");
		    });
		
		// ìƒì„¸ ì •ë³´ ë¡œë”©
		fetch(`Main/anime/detailInfo?animeId=${animeId}`)
		    .then(res => res.json())
		    .then(data => {
		        const startDateEl = document.getElementById("start_date");
		        const totalEpEl = document.getElementById("total_episode");
		        const studioEl = document.getElementById("studio");
		        const studioLinkEl = document.getElementById("studio_link");
		        const ratingEl = document.getElementById("age_rating");
		        const descEl = document.getElementById("anime_desc");
		
		        if (startDateEl) startDateEl.innerText = data.startDate.substring(0, 10) || "ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.";
		        if (totalEpEl) totalEpEl.innerText = data.totalEpisode || "ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.";
		        
		        if (studioEl) {
		        //	studioLinkEl.setAttribute("href", data.studioLink);
		        //	studioLinkEl.setAttribute("target", "_blank"); // ìƒˆ ì°½ ì—´ê¸°
		        	studioEl.innerText = data.studio || "ì œì‘ì‚¬ ì •ë³´ ì—†ìŒ";
		        }
		        
		        if (ratingEl) ratingEl.innerText = data.ageRating || "ë¯¸ì •";
		        if (descEl) descEl.innerHTML = (data.animeDesc || "ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.").replace(/\n/g, "<br>");
		    });
	    // í‰ê°€ ì •ë³´ JSONìœ¼ë¡œ ìš”ì²­
        fetch("/Schedule/rateInfoJson", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ ANIME_ID: animeId }) 
        })
        .then(res => res.json())
        .then(data => {
            // í†µê³„ ë° ì°¨íŠ¸
            document.getElementById("grade-number").textContent = data.grade;
            document.getElementById("grade-mark").textContent = data.gradeMark;
            updateBarChart(data.scoreList, data.countList);
            updateDonutChart(data.maleRatio, data.femaleRatio);

            // ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸
            updateCommentList(data.list);

            // í‰ê°€ ë“±ë¡/ìˆ˜ì • í¼ êµ¬ë¶„
            applyUserRatingForm(data.Aldto, animeId, userId);

            // ëª¨ë‹¬ ì—´ê¸°
            document.getElementById("animeModal").style.display = "block";
            document.querySelector(".modal_content").scrollTop = 0;
        });

	}

    
    document.addEventListener("DOMContentLoaded", function () {
        var swiper = new Swiper(".swiper-container", {
            slidesPerView: 4, // í•œ ë²ˆì— ë³´ì´ëŠ” ìŠ¬ë¼ì´ë“œ ê°œìˆ˜
            spaceBetween: 20, // ì´ë¯¸ì§€ ê°„ê²©
            loop: false, // ë¬´í•œ ë£¨í”„ ì—¬ë¶€
            grabCursor: true, // ë§ˆìš°ìŠ¤ ì»¤ì„œë¥¼ ì†ëª¨ì–‘ìœ¼ë¡œ ë³€ê²½
            navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
            },
            breakpoints: {
                1024: { slidesPerView: 4 },
                768: { slidesPerView: 3 },
                480: { slidesPerView: 2 },
            },
        });

    	// ì´ë¯¸ì§€ í´ë¦­ ì‹œ íŠ¹ì • í˜ì´ì§€ë¡œ ì´ë™
    	document.querySelectorAll(".swiper-slide").forEach((slide, index) => {
			slide.addEventListener("click", () => {
				//window.location.href = `https:example.com/page${index + 1}`;
			});
		});
    });
    
    document.addEventListener("DOMContentLoaded", function () {
        const maxLength = 15; // ìµœëŒ€ ê¸€ì ìˆ˜ (ì›í•˜ëŠ” ê°’ìœ¼ë¡œ ë³€ê²½)

        document.querySelectorAll(".slide-title").forEach(titleElement => {
            let fullTitle = titleElement.textContent.trim(); // ì›ë˜ ì œëª© ê°€ì ¸ì˜¤ê¸°
            
            if (fullTitle.length > maxLength) {
                titleElement.setAttribute("data-title", fullTitle); // data-titleì— ì›ì œëª© ì €ì¥
                titleElement.textContent = fullTitle.substring(0, maxLength) + "..."; // ì¶•ì•½ í›„ í‘œì‹œ
            }
        });
    });
  
 	// ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
    function modal_close() {
	    // ëª¨ë‹¬ ë‚´ë¶€ ìŠ¤í¬ë¡¤ ë¨¼ì € ì´ˆê¸°í™”
	    const modalContent = document.querySelector('.modal_content');
	    if (modalContent) {
	        modalContent.scrollTop = 0;
	    }
	
	    // ëª¨ë‹¬ ìˆ¨ê¸°ê¸°
	    document.getElementById("animeModal").style.display = "none";
	
	    // ì¤„ê±°ë¦¬ ë”ë³´ê¸° ì´ˆê¸°í™”
	    const summaryText = document.querySelector('.ani-summary p');
	    const summaryButton = document.getElementById('summaryButton');
	    if (summaryText.classList.contains('expanded')) {
	        summaryText.classList.remove('expanded');
	        summaryButton.textContent = 'ë”ë³´ê¸°';
	    }
	}




    // ëª¨ë‹¬ ë°”ê¹¥ ì˜ì—­ í´ë¦­ ì‹œ ë‹«ê¸° ê¸°ëŠ¥ ì¶”ê°€
    window.onclick = function(event) {
        let modal = document.getElementById("animeModal");
        if (event.target === modal) {  // ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ ì‹œ
            modal_close();  // ëª¨ë‹¬ ë‹«ê¸° ì‹¤í–‰
        }
    };

    // nav ìŠ¤í¬ë¡¤ ì‹œ ë°˜íˆ¬ëª…í™”
    window.addEventListener("scroll", function () {
        let nav = document.querySelector(".nav");
        let scrollY = window.scrollY;

        // íˆ¬ëª…ë„ ë²”ìœ„ ê³„ì‚° (0.9 ~ 0.3 ì‚¬ì´)
        let baseOpacity = Math.max(0.9, 0.9 - scrollY / 300);

        // ìœ„ìª½ì€ ì§„í•˜ê³ , ì•„ë˜ìª½ì€ íˆ¬ëª…í•´ì§€ëŠ” ê·¸ë¼ë°ì´ì…˜ ìƒì„±
        nav.style.background = `linear-gradient(to bottom, rgba(20, 20, 20, ${baseOpacity}) 0%, rgba(20, 20, 20, 0) 100%)`;
    });


    // ìœ íŠœë¸Œ ìºëŸ¬ì…€ ìë™ ì´ë™
    const swiper = new Swiper('.swiper-container-youtube', {
	    loop: true,
	    autoplay: {
	        delay: 3000,
	        disableOnInteraction: false, // ì‚¬ìš©ìê°€ ë„˜ê²¨ë„ autoplay ìœ ì§€
	        pauseOnMouseEnter: true,     // ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ë©ˆì¶”ê¸°
	    },
	    navigation: {
	        nextEl: '.swiper-button-next',
	        prevEl: '.swiper-button-prev',
	    },
	    slidesPerView: 4,
	    spaceBetween: 10,
	    speed: 1000,
	    slidesPerGroup: 1,
	});

</script>
<script>

function applyUserRatingForm(dto, animeId, userId) {
    const ratedContent = document.getElementById("rated_content");

    if (dto) {
        // ìˆ˜ì • í¼ í‘œì‹œ
        document.getElementById("rateFormArea").style.display = "block";
        document.getElementById("registerFormArea").style.display = "none";
        document.getElementById("rated_user_id").value = dto.USER_ID || userId;
        document.getElementById("rated_anime_id").value = dto.ANIME_ID || animeId;
        document.getElementById("rated_content").value = dto.SCORE_CONTENT; // ê¸°ì¡´ ë‚´ìš© í‘œì‹œ
        applyStars("rated_stars_area", dto.SCORE_SCORE, "SCORE_SCORE");
    } else {
        // ë“±ë¡ í¼ í‘œì‹œ
        document.getElementById("rateFormArea").style.display = "none";
        document.getElementById("registerFormArea").style.display = "block";
        document.getElementById("register_anime_id").value = animeId;
        document.getElementById("register_user_id").value = userId;
        document.getElementById("register_content").value = ""; // ì´ˆê¸°í™”
        // textarea ì´ˆê¸°í™”
        //ratedContent.value = "";  // ëŒ“ê¸€ ë‚´ìš© ì´ˆê¸°í™”
        applyStars("register_stars_area", 3.5, "SCORE_SCORE"); // ê¸°ë³¸ ë³„ì 
    }
}
function applyStars(containerId, selectedValue, inputName) {
    const area = document.getElementById(containerId);
    area.innerHTML = "";
    const scores = [0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5];
    scores.forEach(score => {
        const id = `${inputName}_${score}`;
        const checked = score === selectedValue ? "checked" : "";
        const type = (score * 10) % 10 === 5 ? "half" : "full";
        area.innerHTML += `
            <label class="rating__label rating__label--${type}" for="${id}">
                <input type="radio" id="${id}" class="rating__input" name="${inputName}" value="${score}" ${checked}/>
                <span class="star-icon"></span>
            </label>`;
    });
}
//í‰ì ê²Œì‹œíŒ
function updateCommentList(list) {
    const area = document.getElementById("comment-list-area");
    area.innerHTML = "<h1 style='color: white; text-align: center; margin-bottom: 30px;'>ê²Œì‹œíŒ ëª©ë¡</h1>";
    
    list.forEach(dto => {
        const div = document.createElement("div");
        div.className = "comment-card";
        div.innerHTML = `
        	<div class="comment-left">
            <img src="/IMG/kibon_image.jpg" class="profile-img"/>
            	<div class="user-id">${dto.USER_ID}</div>
            <div class="comment-stars">
                ${generateStarsHTML(dto.SCORE_SCORE)}
            </div>
        </div>
        <div class="comment-right">
            <div class="comment-content-box">
                <div class="comment-content">
                    ${dto.SCORE_CONTENT}
                </div>
            </div>
            <div class="comment-meta">
                ${dto.SCORE_REGDATE.substring(0,10) || 'ì‘ì„±ì¼ì ì—†ìŒ'}
            </div>
        </div>
        `;
        area.appendChild(div);
    });
}

function generateStarsHTML(score) {
    const full = Math.floor(score);
    const half = score % 1 >= 0.5 ? 1 : 0;
    let html = "";
    for (let i = 0; i < full; i++) html += `<img src="/IMG/star_full.png" width="20" height="20"/>`;
    if (half) html += `<img src="/IMG/star_half.png" width="20" height="20"/>`;
    return html;
}

function updateDonutChart(maleRatio, femaleRatio) {	
    const canvas = document.getElementById('genderChart');
    if (!canvas) {
        console.warn("genderChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    const ctx = canvas.getContext('2d');
    const data = [maleRatio, femaleRatio];

    // ì´ë¯¸ í•´ë‹¹ canvasì— ë“±ë¡ëœ ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ Chart.js ë‚´ë¶€ ë“±ë¡ë„ ì œê±°
    const existingChart = Chart.getChart(canvas); // Chart.js v3+
    if (existingChart) {
        existingChart.destroy(); // âœ… ì•ˆì „í•˜ê²Œ ì œê±°
    }

    window.genderChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['ë‚¨ì„±', 'ì—¬ì„±'],
            datasets: [{
                data: data,
                backgroundColor: ['#36A2EB', '#FF6384']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
}

</script>
<!-- ê¸€ììˆ˜ í™•ì¸ í•¨ìˆ˜ -->
<script>
document.addEventListener('DOMContentLoaded', () => {
	  const maxChars = 100;

	  // register í¼
	  const regTA    = document.getElementById('register_content');
	  const regCount = document.getElementById('register_charCount');
	  // ìˆ˜ì • í¼
	  const ratTA    = document.getElementById('rated_content');
	  const ratCount = document.getElementById('rated_charCount');

	  function attachCounter(textarea, counter) {
	    if (!textarea || !counter) return;
	    // ì´ˆê¸° ì„¸íŒ…
	    counter.textContent = `0/${maxChars}`;
	    textarea.addEventListener('input', () => {
	      // ì´ˆê³¼ ìë™ ì»¤íŠ¸ (maxlength ì¨ë„ í˜¹ì‹œ ëª°ë¼ì„œ)
	      if (textarea.value.length > maxChars) {
	        textarea.value = textarea.value.substring(0, maxChars);
	      }
	      // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
	      counter.textContent = `${textarea.value.length}/${maxChars}`;
	    });
	  }

	  attachCounter(regTA, regCount);
	  attachCounter(ratTA, ratCount);
	});
</script>
<!-- ìºëŸ¬ì…€ -->
<script>
const CSswiper = document.querySelector('.carousel_wrapper');
const prevButtons = document.querySelectorAll('.carousel_prev');
const nextButtons = document.querySelectorAll('.carousel_next');
const bullets = document.querySelectorAll('.carousel_circle');
const totalSlides = 7;
let currentSlide = 0;

function showSlide(slideIndex) {
	CSswiper.style.transform = `translateX(-${slideIndex * 1100}px)`;
    currentSlide = slideIndex;

    bullets.forEach((bullet, index) => {
        if (index === currentSlide) {
            bullet.classList.add('active');
        } else {
            bullet.classList.remove('active');
        }
    });
}

prevButtons.forEach((prevButton) => {
    prevButton.addEventListener('click', () => {
    	if (currentSlide === 0) {
            showSlide(totalSlides); // ì²« ë²ˆì§¸ ìŠ¬ë¼ì´ë“œì—ì„œ ì™¼ìª½ ëˆ„ë¥´ë©´ ë§ˆì§€ë§‰ìœ¼ë¡œ ì´ë™
        } else {
            showSlide(currentSlide - 1);
        }
    });
});

nextButtons.forEach((nextButton) => {
    nextButton.addEventListener('click', () => {
    	if (currentSlide === totalSlides) {
            showSlide(0); // ë§ˆì§€ë§‰ ìŠ¬ë¼ì´ë“œì—ì„œ ì˜¤ë¥¸ìª½ ëˆ„ë¥´ë©´ ì²˜ìŒìœ¼ë¡œ ì´ë™
        } else {
            showSlide(currentSlide + 1);
        }
    });
});

bullets.forEach((bullet, index) => {
    bullet.addEventListener('click', () => {
        showSlide(index);
    });
});

showSlide(0);
</script>

<script>
//ëª¨ë‹¬ ë‚´ë¶€ ì¤„ê±°ë¦¬ í™•ì¥ ë²„íŠ¼
  const summaryText = document.querySelector('.ani-summary p');
  const summaryButton = document.getElementById('summaryButton');

  summaryButton.addEventListener('click', () => {
    summaryText.classList.toggle('expanded');
    if (summaryText.classList.contains('expanded')) {
      summaryButton.textContent = 'ì ‘ê¸°';
    } else {
      summaryButton.textContent = 'ë”ë³´ê¸°';
    }
  });
</script>

<!-- ìœ íŠœë¸Œ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.youtube-thumbnail').forEach(thumbnail => {
        thumbnail.addEventListener('click', function() {
            const videoId = this.dataset.videoId;
            this.innerHTML = `<iframe width="400" height="315"
                                src="https://www.youtube.com/embed/${videoId}?autoplay=1"
                                title="YouTube video player" frameborder="0"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                allowfullscreen></iframe>`;
        });
    });

    // ìœ íŠœë¸Œ ìºëŸ¬ì…€ Swiper í™œì„±í™”
    const swiper = new Swiper('.swiper-container-youtube', {
        loop: true,
        autoplay: {
            delay: 3000,
            disableOnInteraction: false,
        },
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        },
        slidesPerView: 4,
        spaceBetween: 10,
        speed: 1000,
        loopedSlides: 4,
        slidesPerGroup: 1,
    });
});
</script>

<!-- ì• ë‹ˆ ë­í‚¹ ìºëŸ¬ì…€ -->
<script>
const swiperRanking = new Swiper('.swiper-container-ranking', {
    direction: 'vertical',
    slidesPerView: 5,
    spaceBetween: 10,
    loop: true,
    autoplay: {
        delay: 2500,
        disableOnInteraction: false,
    },
});



</script>

<script src="/js/navbar.js"></script>
</html>